<!doctype html>



  


<html class="theme-next mist use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="youngleish" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta name="description" content="纸上得来中觉浅,绝知此事要躬行">
<meta property="og:type" content="website">
<meta property="og:title" content="youngleish">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="youngleish">
<meta property="og:description" content="纸上得来中觉浅,绝知此事要躬行">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="youngleish">
<meta name="twitter:description" content="纸上得来中觉浅,绝知此事要躬行">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: '博主'
    }
  };
</script>




  <link rel="canonical" href="http://yoursite.com/"/>

  <title> youngleish </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">youngleish</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/07/21/h5-mobile/" itemprop="url">
                  移动端-- 基本概念篇
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-07-21T23:04:28+08:00" content="2016-07-21">
              2016-07-21
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/移动端/" itemprop="url" rel="index">
                    <span itemprop="name">移动端</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>移动端响应式适配的疑问:</p>
<ul>
<li>像素大小会变么？</li>
<li>为什么对显示器的分辨率进行缩放，文字和图片会相应的变大或变小？</li>
<li>为什么图片放大会变模糊？</li>
<li>为什么普通屏幕上正常显示的图片放在在retina屏幕上会变模糊？如何解决这个问题？</li>
<li>2倍图放在普通屏幕中会怎样？</li>
</ul>
<h4 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h4><h6 id="物理像素（设备像素）："><a href="#物理像素（设备像素）：" class="headerlink" title="物理像素（设备像素）："></a>物理像素（设备像素）：</h6><p>是显示屏中最小的物理单位，每一个像素中都会依据操作系统设置显示相应的颜色，亮度等信息。</p>
<h6 id="css像素："><a href="#css像素：" class="headerlink" title="css像素："></a>css像素：</h6><p>是浏览器中使用的度量单位，用来精确度量网页中的内容，也被称为<strong>设备独立像素（device indepedent pixels - dip）</strong>,或者称为与设备无关的逻辑像素。meta里的content=”width=device-width”中device-width就是指设备独立像素，可以通过screen.width/height获得数据。</p>
<h6 id="位图像素："><a href="#位图像素：" class="headerlink" title="位图像素："></a>位图像素：</h6><p>该像素是位图图像（jpg,png,gif）中最小的数据单元，每个像素用二进制描述了图像的颜色，亮度，透明度等信息。位图的大小和质量取决于像素的多少，每平方英寸中包含的像素个数越多，位图就越清晰，颜色之间的过度就越平滑。</p>
<h6 id="分辨率"><a href="#分辨率" class="headerlink" title="分辨率:"></a>分辨率:</h6><p>分辨率展示了显示器（手机屏幕）横向和纵向包含的像素个数，这里的像素是指设备像素，例如：iPhone6的分辨率是750px*1334px，就表示横向包含了750个像素，纵向包含了1334个像素。</p>
<h6 id="设备像素比（device-pixel-ratio）-："><a href="#设备像素比（device-pixel-ratio）-：" class="headerlink" title="设备像素比（device pixel ratio） ："></a>设备像素比（device pixel ratio） ：</h6><p>简称dpr，展示了设备像素和css像素的关系，公式：</p>
<blockquote>
<p>dpr = 设备像素 / css像素； //同一个方向上</p>
</blockquote>
<p>在js中可以通过window.devicePixelRatio获取到，css中可以通过-webkit-device-pixel-ratio，-webkit-min-device-pixel-ratio,-webkit-max-device-pixel-ratio来根据不同的设备展示不同的样式。</p>
<p>####### 屏幕像素密度（pixels per inch）:<br>是指每英寸屏幕中包含的像素个数。可以通过下面的公式计算粗来：</p>
<blockquote>
<p>PPI = 屏幕对角线包含的像素个数 / 屏幕尺寸</p>
</blockquote>
<h4 id="解释我的疑问"><a href="#解释我的疑问" class="headerlink" title="解释我的疑问"></a>解释我的疑问</h4><h6 id="问题1-像素大小会变么？"><a href="#问题1-像素大小会变么？" class="headerlink" title="问题1: 像素大小会变么？"></a>问题1: 像素大小会变么？</h6><p>以iPhone3Gs和iPhone4为例：</p>
<table>
<thead>
<tr>
<th style="text-align:left">设备</th>
<th style="text-align:center">屏幕尺寸</th>
<th style="text-align:right">设备分辨率</th>
<th style="text-align:right">PPI</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">iPhone 3Gs</td>
<td style="text-align:center">3.5 inch</td>
<td style="text-align:right">320px * 480px</td>
<td style="text-align:right">163</td>
</tr>
<tr>
<td style="text-align:left">iPhone 4</td>
<td style="text-align:center">3.5 inch</td>
<td style="text-align:right">640px * 960px</td>
<td style="text-align:right">326</td>
</tr>
</tbody>
</table>
<p>通过上面的表格看到iPhone3Gs和4的屏幕尺寸大小一样，都是3.5英寸，但是在4的屏幕密度（PPI）却是3Gs的2倍，说明每英寸屏幕中4的物理像素要比3Gs多2倍，由此可见物理像素的大小是会变的，在iPhone4中的物理像素比3Gs小。</p>
<h6 id="问题2：为什么对显示器的分辨率进行缩放，文字和图片会相应的变大或变小？"><a href="#问题2：为什么对显示器的分辨率进行缩放，文字和图片会相应的变大或变小？" class="headerlink" title="问题2：为什么对显示器的分辨率进行缩放，文字和图片会相应的变大或变小？"></a>问题2：为什么对显示器的分辨率进行缩放，文字和图片会相应的变大或变小？</h6><p>例如：电脑的显示器分辨率为1280px<em>800px ,我把他的分辨率调到1440px</em>900px，屏幕的ppi变大，相应的物理像素会变小，但是同一台电脑的dpr是不会变的，也就是说物理像素和css像素的比例是不变的，物理像素变小，css像素也会变小，因此放大显示器的分辨率文字和图片会相应变小，反之会变大。</p>
<h6 id="问题3：-为什么图片放大会变模糊？"><a href="#问题3：-为什么图片放大会变模糊？" class="headerlink" title="问题3： 为什么图片放大会变模糊？"></a>问题3： 为什么图片放大会变模糊？</h6><p>没有缩放图片的时候，位图像素和设备像素是1：1的关系，当图片放大2倍以后，一个位图像素会覆盖4个设备像素，位图像素和设备像素是1：4的关系，但是单个的位图像素是不会分裂的，所以导致对应的设备像素只能就近取色，所以图片看起来是模糊的。<br><a href="http://weizhifeng.net/a-pixel-is-not.html" target="_blank" rel="external">参考链接</a></p>
<h6 id="问题4：为什么普通屏幕上正常显示的图片放在在retina屏幕上会变模糊？"><a href="#问题4：为什么普通屏幕上正常显示的图片放在在retina屏幕上会变模糊？" class="headerlink" title="问题4：为什么普通屏幕上正常显示的图片放在在retina屏幕上会变模糊？"></a>问题4：为什么普通屏幕上正常显示的图片放在在retina屏幕上会变模糊？</h6><p>其实和图片放大是一个原理，都是dpr（设备像素比）惹的祸，普通屏中设备像素和位图像素是1：1，但是在dpr为2的retina屏幕中，设备像素和位图像素是4：1，同样位图像素不会分裂成4个，所以对应的设备像素就近取色，图片看起来就会模糊。</p>
<h6 id="那如何避免图片变模糊呢？"><a href="#那如何避免图片变模糊呢？" class="headerlink" title="那如何避免图片变模糊呢？"></a>那如何避免图片变模糊呢？</h6><p>在项目中主要是通过：取2倍图片，在css设置中宽和高是图片本身的50%。<br>以iPhone6为例，UI效果是图片撑满整屏，为了保证图片能清晰可见，我们要拿一张750px*1334px的图片，css中宽和高设成：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.pic&#123;</span><br><span class="line">	width:375px;</span><br><span class="line">	height:677px;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这样设置的结果是css像素和位图像素比例是1：4，而css像素和设备像素也是1:4的关系，那么位图像素和设备像素就是1：1的关系，因此图片可以清晰展示。</p>
<h6 id="问题5：-2倍图放在普通屏幕中会怎样？"><a href="#问题5：-2倍图放在普通屏幕中会怎样？" class="headerlink" title="问题5： 2倍图放在普通屏幕中会怎样？"></a>问题5： 2倍图放在普通屏幕中会怎样？</h6><p>同样拿上面的栗子来说，普通屏幕的dpr是1，css像素和设备像素是1：1,对于图片css像素和位图像素是1：4，那么设备像素和位图像素也是1：4的关系，也就是1个设备像素对应4个位图像素，对于设备来说，只能通过算法去位图像素的近似值，这个过程叫downsampling,图片虽不会变得模糊，但是会失去原有的锐利度.<a href="http://www.html-js.com/article/Mobile-terminal-H5-mobile-terminal-HD-multi-screen-adaptation-scheme%203041" target="_blank" rel="external">参考资料</a></p>
<h6 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料:"></a>参考资料:</h6><ul>
<li><a href="http://www.w3cplus.com/css/towards-retina-web.html" target="_blank" rel="external">http://www.w3cplus.com/css/towards-retina-web.html</a></li>
<li><a href="http://www.html-js.com/article/Mobile-terminal-H5-mobile-terminal-HD-multi-screen-adaptation-scheme%203041" target="_blank" rel="external">http://www.html-js.com/article/Mobile-terminal-H5-mobile-terminal-HD-multi-screen-adaptation-scheme%203041</a></li>
<li><a href="http://www.jianshu.com/p/c3387bcc4f6e" target="_blank" rel="external">http://www.jianshu.com/p/c3387bcc4f6e</a></li>
<li><a href="http://html5online.com.cn/articles/2013041701.html" target="_blank" rel="external">http://html5online.com.cn/articles/2013041701.html</a></li>
<li><a href="http://weizhifeng.net/a-pixel-is-not.html" target="_blank" rel="external">http://weizhifeng.net/a-pixel-is-not.html</a></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/07/10/webpack/" itemprop="url">
                  构建工具--webpack实践
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-07-10T13:39:13+08:00" content="2016-07-10">
              2016-07-10
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/构建工具/" itemprop="url" rel="index">
                    <span itemprop="name">构建工具</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="多个文件入口"><a href="#多个文件入口" class="headerlink" title="多个文件入口"></a>多个文件入口</h4><p>项目中入口文件都放在src/public/js/entry文件夹下面了，并且根据业务的特点做了不同的命名，在查阅webpack的文档时发现，文档中多个文件入口都类似这样配置的：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">entry: &#123; //配置入口文件，有几个写几个</span><br><span class="line">        index: &apos;./src/js/page/index.js&apos;,</span><br><span class="line">        list: &apos;./src/js/page/list.js&apos;,</span><br><span class="line">        about: &apos;./src/js/page/about.js&apos;,</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>这种方式非常不方便，比如项目中新增了js文件，还要手动去改Webpack的配置文件，有没有什么方法可以批量处理这些入口文件呢？</p>
<h6 id="glob"><a href="#glob" class="headerlink" title="glob"></a>glob</h6><p>Node.js中的glob模块是主要功能是匹配指定模式下的文件或者目录。<br>glob有同步和异步2种方法，2种方法的区别就在于回调函数。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">var glob = require(&apos;glob&apos;);</span><br><span class="line">var sourcePath = &apos;./src/public/js/entry/**/*.js&apos;;</span><br><span class="line">//同步方法</span><br><span class="line">glob(sourcePath,function(er,files)&#123;</span><br><span class="line">    console.log(files);</span><br><span class="line">&#125;);</span><br><span class="line">//异步方法</span><br><span class="line">console.log(glob.sync(sourcePath));</span><br></pre></td></tr></table></figure>
<p>两种方法返回的结果一样都是一个数组</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"> cmstmplate git:(yanglei/gulp) ✗ node app.js</span><br><span class="line">[ &apos;./src/public/js/entry/buyer/buyer2.js&apos;,</span><br><span class="line">  &apos;./src/public/js/entry/buyer1.js&apos;,</span><br><span class="line">  &apos;./src/public/js/entry/help/help.js&apos;,</span><br><span class="line">  &apos;./src/public/js/entry/shaidan/shaidan1.js&apos;,</span><br><span class="line">  &apos;./src/public/js/entry/shaidan/shaidan2.js&apos;,</span><br><span class="line">  &apos;./src/public/js/entry/shaidan/shaidan3.js&apos;,</span><br><span class="line">  &apos;./src/public/js/entry/stock/stock.js&apos; ]</span><br></pre></td></tr></table></figure>
<h6 id="path"><a href="#path" class="headerlink" title="path"></a>path</h6><p>Node.js还有一个path模块用来处理文件路径:</p>
<ul>
<li>目录名 path.dirname()</li>
<li>文件名 path.basename()</li>
<li>扩展名 path.extname()</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">console.log(path.dirname(&apos;./src/public/js/entry/help/help.js&apos;));</span><br><span class="line">console.log(path.basename(&apos;./src/public/js/entry/help/help.js&apos;));</span><br><span class="line">console.log(path.extname(&apos;./src/public/js/entry/help/help.js&apos;));</span><br><span class="line">//结果</span><br><span class="line">➜  cmstmplate git:(yanglei/gulp) ✗ node app.js</span><br><span class="line">./src/public/js/entry/help</span><br><span class="line">help.js</span><br><span class="line">.js</span><br></pre></td></tr></table></figure>
<p>另外path.basename() 还可以传第二个参数文件的扩展名，指定扩展名以后就可以得到文件名了。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">console.log(path.basename(&apos;./src/public/js/entry/help/help.js&apos;,&apos;.js&apos;));</span><br><span class="line">//结果</span><br><span class="line">➜  cmstmplate git:(yanglei/gulp) ✗ node app.js</span><br><span class="line">help</span><br></pre></td></tr></table></figure>
<h6 id="批量处理入口文件"><a href="#批量处理入口文件" class="headerlink" title="批量处理入口文件"></a>批量处理入口文件</h6><p>利用glob获取文件做为入口文件对象的value,path的basename方法获取文件名做为入口文件对象的key.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">var glob = require(&apos;glob&apos;);</span><br><span class="line">var path = require(&apos;path&apos;);</span><br><span class="line">var sourcePath = &apos;./src/public/js/entry/**/*.js&apos;;</span><br><span class="line">var entry = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">glob.sync(sourcePath).forEach(function(item)&#123;</span><br><span class="line">    var extName = path.extname(item);</span><br><span class="line">    var baseName = path.basename(item,extName);</span><br><span class="line">    entry[baseName] = item;</span><br><span class="line">&#125;);</span><br><span class="line">console.log(entry);</span><br><span class="line"></span><br><span class="line">//结果</span><br><span class="line">➜  cmstmplate git:(yanglei/gulp) ✗ node app.js</span><br><span class="line">&#123; buyer2: &apos;./src/public/js/entry/buyer/buyer2.js&apos;,</span><br><span class="line">  buyer1: &apos;./src/public/js/entry/buyer1.js&apos;,</span><br><span class="line">  help: &apos;./src/public/js/entry/help/help.js&apos;,</span><br><span class="line">  shaidan1: &apos;./src/public/js/entry/shaidan/shaidan1.js&apos;,</span><br><span class="line">  shaidan2: &apos;./src/public/js/entry/shaidan/shaidan2.js&apos;,</span><br><span class="line">  shaidan3: &apos;./src/public/js/entry/shaidan/shaidan3.js&apos;,</span><br><span class="line">  stock: &apos;./src/public/js/entry/stock/stock.js&apos; &#125;</span><br></pre></td></tr></table></figure>
<h4 id="合并js"><a href="#合并js" class="headerlink" title="合并js"></a>合并js</h4><p>后续会继续更新…</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/06/26/gulp-stream/" itemprop="url">
                  构建工具--Gulp中的stream
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-06-26T22:32:44+08:00" content="2016-06-26">
              2016-06-26
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/构建工具/" itemprop="url" rel="index">
                    <span itemprop="name">构建工具</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>月影大大在<a href="http://www.75team.com/post/gulp-build.html" target="_blank" rel="external">使用Gulp构建网站小白教程</a>这篇文章中引用的描述，可以让我们更详细的了解Gulp的功能：</p>
<blockquote>
<p>Gulp.js是一个自动化构建工具,开发者可以使用它在项目开发过程中自动执行常见的任务。Gulp.js是基于Node.js构建的，利用Node.js流的威力，你可以快速的构建项目并减少频繁的IO操作。Gulp.js源文件和你用来定义任务的Gulp文件都是通过Javascript （或者CoffeeScript） 源码来实现的。</p>
</blockquote>
<p>可以看到Gulp是基于流的，但是在查看Gulp的api的时候,看到gulp.src()方法中的参数options.buffer让我对流产生了疑问,api只有在options.buffer值设置成false的时候才会以 stream 方式返回 file.contents,说好了不是以stream方式运行的么,怎么在获取流的时候默认是以buffer的形式返回file.contents呢? 另外Gulp.js的stream和Node.js的stream有什么区别么?带着这个疑问我开始学习gulp中的stream。</p>
<h4 id="Vinyl-File-Object-Sream（虚拟文件对象流）"><a href="#Vinyl-File-Object-Sream（虚拟文件对象流）" class="headerlink" title="Vinyl File Object Sream（虚拟文件对象流）"></a>Vinyl File Object Sream（虚拟文件对象流）</h4><p>Gulp中的流是<strong>Vinyl File Object Sream</strong>（虚拟文件对象流），用的是一个npm的vinyl-fs模块。</p>
<h4 id="Vinyl"><a href="#Vinyl" class="headerlink" title="Vinyl"></a>Vinyl</h4><p>Vinyl 是一个虚拟文件格式,主要用来描述文件信息,通过<a href="https://www.npmjs.com/package/vinyl" target="_blank" rel="external">官网</a>可以看到vinyl是一个对象，有4个属性cwd（工作目录）、base、path、contets,主要使用的属性是path和contents。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">var File = require(&apos;vinyl&apos;);</span><br><span class="line"></span><br><span class="line">var coffeeFile = new File(&#123;</span><br><span class="line">  cwd: &quot;/&quot;,</span><br><span class="line">  base: &quot;/test/&quot;,</span><br><span class="line">  path: &quot;/test/file.coffee&quot;,</span><br><span class="line">  contents: new Buffer(&quot;test = 123&quot;)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">//下面代码是检测四个属性值</span><br><span class="line">gulp.task(&apos;test&apos;,function()&#123;</span><br><span class="line">    return gulp.src(&apos;./static/style/block/button.less&apos;).on(&apos;data&apos;,function(file)&#123;</span><br><span class="line">        console.log(file.cwd);</span><br><span class="line">        console.log(file.base);</span><br><span class="line">        console.log(file.path);</span><br><span class="line">        console.log(file.contents);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line">//结果</span><br><span class="line"></span><br><span class="line">➜  web git:(feature/jn) ✗ gulp test</span><br><span class="line">[21:33:45] Using gulpfile ~/aimei/buyer/web/gulpfile.js</span><br><span class="line">[21:33:45] Starting &apos;test&apos;...</span><br><span class="line">/Users/young/aimei/buyer/web</span><br><span class="line">/Users/young/aimei/buyer/web/static/style/block/</span><br><span class="line">/Users/young/aimei/buyer/web/static/style/block/button.less</span><br><span class="line">&lt;Buffer 2e 62 75 74 74 6f 6e 28 29 20 7b 0a 20 20 20 20 2e 62 6f 72 64 65 72 2d 72 28 32 70 78 29 3b 0a 20 20 20 20 2e 63 75 72 73 6f 72 3b 0a 20 20 20 20 2e ... &gt;</span><br><span class="line">[21:33:45] Finished &apos;test&apos; after 19 ms</span><br></pre></td></tr></table></figure>
<h4 id="Vinyl-fs"><a href="#Vinyl-fs" class="headerlink" title="Vinyl-fs"></a>Vinyl-fs</h4><p>官网中提到Vinyl-fs是文件系统的适配器（adapter）。Vinyl提供了描述文件的方法，适配器Vinyl-fs为访问这些文件提供了方法，主要暴露了3个方法：.src(globs),.dest(folder)和.watch(glob,fn)。通过查看<a href="https://github.com/MissHoya/weui-gulpfile-analysis/blob/master/gulpfile.js" target="_blank" rel="external">Gulp源码</a>可以看到Gulp的src,dest的方法继承于Vinyl-fs.</p>
<h4 id="为什么不使用Node-js-中的stream"><a href="#为什么不使用Node-js-中的stream" class="headerlink" title="为什么不使用Node.js 中的stream"></a>为什么不使用Node.js 中的stream</h4><p>Node.js 中的stream只传输String和Buffer, 注重的是文件的内容，而Gulp.js不止需要文件的内容，还需要用到文件的路径等信息，因此才会使用Vinyl File Object Stream。</p>
<h4 id="为什么gulp-src中options-buffer默认是buffer形式返回文件内容"><a href="#为什么gulp-src中options-buffer默认是buffer形式返回文件内容" class="headerlink" title="为什么gulp.src中options.buffer默认是buffer形式返回文件内容"></a>为什么gulp.src中options.buffer默认是buffer形式返回文件内容</h4><p>虚拟文件对象(Vinyl File Object)的contents有三种类型：</p>
<ul>
<li>Stream</li>
<li>Buffer</li>
<li>Null</li>
</ul>
<p>Stream可以把数据分成数据块（chunk）传输,我们可以通过监听data事件来检测chunk:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">gulp.task(&apos;stream&apos;,function()&#123;</span><br><span class="line">    return gulp.src(&apos;./word.js&apos;,&#123;buffer:false&#125;)</span><br><span class="line">        .on(&apos;data&apos;,function(file)&#123;</span><br><span class="line">            var stream = file.contents;</span><br><span class="line">            stream.on(&apos;data&apos;, function(chunk) &#123;</span><br><span class="line">                console.log(&apos;Read %d bytes of data&apos;, chunk.length);</span><br><span class="line">                console.log(Buffer.isBuffer(chunk));</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">//结果：</span><br><span class="line"></span><br><span class="line">➜  cmstmplate git:(yanglei/gulp) ✗ gulp stream</span><br><span class="line">[13:36:23] Using gulpfile ~/Sites/AMBackend/operate/web/cmstmplate/gulpfile.js</span><br><span class="line">[13:36:23] Starting &apos;stream&apos;...</span><br><span class="line">[13:36:23] Finished &apos;stream&apos; after 18 ms</span><br><span class="line">Read 65536 bytes of data</span><br><span class="line">true</span><br><span class="line">Read 65536 bytes of data</span><br><span class="line">true</span><br><span class="line">Read 35634 bytes of data</span><br><span class="line">true</span><br></pre></td></tr></table></figure>
<p>可以看到stream的数据块是也是buffer。Gulp中默认使用buffer形式,也就是说我们通过gulp.src()获取的不是chunk,而是转换成buffer以后的一个虚拟文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">gulp.task(&apos;buffer&apos;,function()&#123;</span><br><span class="line">    return gulp.src(&apos;./word.js&apos;)</span><br><span class="line">        .on(&apos;data&apos;,function(file)&#123;</span><br><span class="line">            var stream = file.contents;</span><br><span class="line">            console.log(&apos;Read %d bytes of data&apos;, stream.length);</span><br><span class="line">            console.log(stream);</span><br><span class="line">            console.log(Buffer.isBuffer(stream));</span><br><span class="line">        &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">//结果</span><br><span class="line"></span><br><span class="line">➜  cmstmplate git:(yanglei/gulp) ✗ gulp buffer</span><br><span class="line">[13:45:57] Using gulpfile ~/Sites/AMBackend/operate/web/cmstmplate/gulpfile.js</span><br><span class="line">[13:45:57] Starting &apos;buffer&apos;...</span><br><span class="line">Read 166706 bytes of data</span><br><span class="line">&lt;Buffer 21 66 75 6e 63 74 69 6f 6e 28 65 2c 74 29 7b 66 75 6e 63 74 69 6f 6e 20 69 28 29 7b 76 61 72 20 74 3d 6e 2e 67 65 74 42 6f 75 6e 64 69 6e 67 43 6c 69 ... &gt;</span><br><span class="line">true</span><br></pre></td></tr></table></figure>
<p>Gulp默认使用buffer格式，是因为有些任务例如：压缩js,文本替换等，需要完整的文件内容来操作。</p>
<h4 id="参考文章："><a href="#参考文章：" class="headerlink" title="参考文章："></a>参考文章：</h4><p>这些连接是我学习过程中阅读过的文章，对我认识stream有很大的帮助，谢谢各位无私奉献大神。<br><a href="http://acgtofe.com/posts/2015/09/dive-into-gulp-stream" target="_blank" rel="external">http://acgtofe.com/posts/2015/09/dive-into-gulp-stream</a><br><a href="https://csspod.com/advanced-tips-for-using-gulp-js/" target="_blank" rel="external">https://csspod.com/advanced-tips-for-using-gulp-js/</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  


          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="youngleish" />
          <p class="site-author-name" itemprop="name">youngleish</p>
          <p class="site-description motion-element" itemprop="description">纸上得来中觉浅,绝知此事要躬行</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">3</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">2</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">4</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">youngleish</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  



  




  
  
  

  

  

</body>
</html>
